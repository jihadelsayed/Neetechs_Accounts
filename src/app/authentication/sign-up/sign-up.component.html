<div class="body-signup">
  <div class="signup-layout">
    <div class="signup-top">
      <!-- Left Panel -->
      <div class="left-panel">
        <img src="https://i.imgur.com/3fLGfPn.png" alt="Neetechs Logo" />
        <h2 class="step-indicator">Create your Neetechs account</h2>
        <p class="login-link">
          Already have an account? <a routerLink="/login">Log In</a>
        </p>

        <div class="progress-bar-wrapper">
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="step * 33.33"></div>
          </div>
          <p class="progress-text">Step {{ step }} of 3</p>
        </div>
      </div>

      <!-- Right Panel (Form) -->
      <div class="right-panel signup-container">
        @if (!stepLoading) {
        <form #signupForm="ngForm" (ngSubmit)="OnSubmit(signupForm)">
          <!-- STEP 1: Email or phone + consent -->
          @if (step === 1) {
          <div class="stepDev">
            <p class="toggle-note">
              Choose how you'd like to sign up. You'll receive a confirmation
              code via your selected method.
            </p>

            <div class="toggle-group">
              <button
                type="button"
                [class.active]="!useEmail"
                (click)="useEmail = false"
              >
                Mobile Number
              </button>
              <button
                type="button"
                [class.active]="useEmail"
                (click)="useEmail = true"
              >
                Email
              </button>
            </div>

            @if (useEmail) {
            <div>
              <input
                type="email"
                name="email"
                [(ngModel)]="user.email"
                placeholder="Email"
                required
                autocomplete="email"
                #emailRef="ngModel"
                [class.invalid]="emailRef.invalid && emailRef.touched"
              />
              @if (emailRef.invalid && emailRef.touched) {
              <div class="error">Invalid email address</div>
              }
            </div>
            } @else {
            <div class="phone-group">
              <select [(ngModel)]="selectedCountry" name="country" required>
                @for (c of phoneService.countries; track c.code) {
                <option [value]="c.code">{{ c.flag }} +{{ c.dialCode }}</option>
                }
              </select>

              <input
                type="tel"
                name="phone"
                [(ngModel)]="user.phone"
                required
                #phoneRef="ngModel"
                [class.invalid]="
                  (phoneRef.invalid ||
                    !phoneService.isValidPhone(
                      phoneService.getFullPhoneNumber(
                        this.selectedCountry,
                        this.user.phone
                      )
                    )) &&
                  phoneTouched
                "
                (blur)="phoneTouched = true"
                placeholder="Mobile number"
              />
            </div>

            @if ( (phoneRef.invalid || !phoneService.isValidPhone(
            phoneService.getFullPhoneNumber( this.selectedCountry,
            this.user.phone ) )) && phoneTouched ) {
            <div class="error">Invalid phone number</div>
            } }

            <label class="terms-checkbox">
              <input
                type="checkbox"
                name="smsConsent"
                [(ngModel)]="user.smsConsent"
                required
              />

              I agree to receive account-related and marketing messages via SMS.
              Standard rates may apply. By continuing, I accept the
              <a href="https://neetechs.com/en/terms-of-service" target="_blank"
                >Terms of Service</a
              >
              and
              <a href="https://neetechs.com/en/privacy-policy" target="_blank"
                >Privacy Policy</a
              >.
            </label>

            <button
              type="button"
              class="nextButton"
              (click)="nextStepWithSpinner()"
              [disabled]="!isStep1Valid()"
            >
              Next
            </button>
          </div>
          }

          <!-- Step 1.5 - Phone Verification (separate component) -->
          @if (step === 1.5) {
          <app-signup-phone-verification
            [selectedCountry]="selectedCountry"
            [phone]="user.phone"
            (back)="step = 1"
            (verify)="verifyCode()"
          ></app-signup-phone-verification>
          }

          <!-- STEP 2: name + username -->
          @if (step === 2) {
          <div class="stepDev">
            <input
              type="text"
              name="name"
              [(ngModel)]="user.name"
              placeholder="First Name"
              required
            />
            <input
              type="text"
              name="username"
              [(ngModel)]="user.username"
              placeholder="Username"
              required
            />

            <button
              type="button"
              class="backButton"
              (click)="prevStepWithSpinner()"
            >
              Back
            </button>
            <button
              type="button"
              [disabled]="stepLoading"
              class="nextButton"
              (click)="nextStepWithSpinner()"
            >
              @if (!stepLoading) { Next } @else {
              <img
                src="https://i.imgur.com/llF5iyg.gif"
                alt="loading"
                width="20"
              />
              }
            </button>
          </div>
          }

          <!-- STEP 3: passwords -->
          @if (step === 3) {
          <app-signup-password-step
            [user]="user"
            [passwordStrength]="passwordStrength"
            [strengthClass]="strengthClass"
            [passwordMismatch]="passwordMismatch"
            [showPassword]="showPassword"
            [loading]="loading"
            (showPasswordChange)="showPassword = $event"
            (back)="prevStepWithSpinner()"
            (submit)="OnSubmit(signupForm)"
            (passwordInput)="evaluatePasswordStrength($event)"
          ></app-signup-password-step>
          }
        </form>

        <div class="divider">Or sign up with</div>
        <!-- reuse same social component as login, or keep buttons -->
        <app-social-login-buttons></app-social-login-buttons>
        } @else {
        <div class="step-spinner">
          <img src="https://i.imgur.com/llF5iyg.gif" alt="Loading..." />
        </div>
        }
      </div>
    </div>

    <!-- Footer -->
    <footer class="form-footer">
      <select [(ngModel)]="language">
        <option value="en">English</option>
        <option value="es">Espanol</option>
      </select>
      <div>
        <a href="https://neetechs.com/en/terms-of-service" target="_blank"
          >Terms</a
        >
        <a href="https://neetechs.com/en/privacy-policy" target="_blank"
          >Privacy</a
        >
        <a href="https://neetechs.com/en/customer-support" target="_blank"
          >Help</a
        >
      </div>
    </footer>
  </div>
</div>
